# CodeDojo Render Blueprint Configuration
# This file defines the infrastructure for the CodeDojo application

services:
  # Main web service - builds from Dockerfile and serves both backend API and frontend
  - type: web
    name: coddojo
    runtime: docker # Use 'runtime' instead of deprecated 'env'
    dockerfilePath: ./Dockerfile
    dockerContext: .
    region: virginia # Default region
    plan: free # Default plan for new services
    autoDeployTrigger: commit # Auto-deploy on every commit
    healthCheckPath: /api/health
    envVars:
      - key: PORT
        value: 8000
      - key: ENVIRONMENT
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: coddojo-db
          property: connectionString

# Render Postgres databases
databases:
  - name: coddojo-db
    plan: free # Free tier for development
    databaseName: coddojo # Database name within PostgreSQL instance
    region: virginia
    postgresMajorVersion: '16' # Use recent stable version
    ipAllowList: # Allow connections from anywhere (can restrict later)
      - source: 0.0.0.0/0
        description: allow all connections
